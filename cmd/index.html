---
layout: null
sitemap: false
---
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<meta name="robots" content="noindex,nofollow"/>
<title>cmd</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0a14;--bg2:#10101f;--card:#151528;--card2:#1a1a32;
  --bdr:#222244;--bdr2:#2d2d55;
  --tx:#e8e8f4;--tx2:#9999bb;--tx3:#666688;
  --mint:#7dffc4;--mint2:#7dffc422;--mint3:#7dffc411;
  --coral:#ff8fab;--coral2:#ff8fab22;
  --lilac:#c4a8ff;--lilac2:#c4a8ff22;
  --sky:#7dc4ff;--sky2:#7dc4ff22;
  --amber:#ffd07d;--amber2:#ffd07d22;
  --red:#ff6b8a;--red2:#ff6b8a22;
  --mono:'DM Mono',monospace;--sans:'Nunito',sans-serif;
  --radius:12px;--radius-sm:8px;
}
body{background:var(--bg);color:var(--tx);font-family:var(--mono);font-size:13px;line-height:1.5;min-height:100vh;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--bdr);border-radius:3px}

/* AUTH */
#auth{min-height:100vh;display:flex;align-items:center;justify-content:center;position:relative}
#auth::before{content:'';position:absolute;top:50%;left:50%;width:500px;height:500px;transform:translate(-50%,-50%);background:radial-gradient(circle,var(--mint2) 0%,transparent 70%);pointer-events:none}
.auth-box{position:relative;z-index:1;text-align:center}
.auth-kirby{margin-bottom:28px}
.auth-label{font-size:10px;letter-spacing:5px;color:var(--mint);margin-bottom:28px;font-weight:500}
.auth-input{display:block;width:260px;padding:14px 20px;background:var(--card);border:1px solid var(--bdr);border-radius:var(--radius);color:var(--tx);font-family:var(--mono);font-size:14px;text-align:center;letter-spacing:4px;outline:none;transition:border-color .2s}
.auth-input:focus{border-color:var(--mint)}
.auth-input::placeholder{letter-spacing:2px;color:var(--tx3)}
.auth-err{margin-top:12px;font-size:11px;color:var(--red);letter-spacing:2px;height:16px}

/* LAYOUT */
.header{padding:16px 24px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#0e0e1e 0%,var(--bg) 100%)}
.header-left .h-label{font-size:9px;letter-spacing:5px;color:var(--mint);font-weight:500;margin-bottom:2px}
.header-left .h-title{font-family:var(--sans);font-size:20px;font-weight:800;color:#fff}
.header-right{text-align:right;font-size:10px;color:var(--tx3);letter-spacing:1px}
.header-right span{color:var(--mint)}

.tabs{display:flex;border-bottom:1px solid var(--bdr);background:var(--bg2);overflow-x:auto}
.tab{flex:1;padding:12px 8px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--tx3);font-family:var(--mono);font-size:10px;letter-spacing:1.5px;cursor:pointer;transition:all .15s;white-space:nowrap}
.tab:hover{color:var(--tx2)}
.tab.on{color:var(--mint);border-bottom-color:var(--mint);background:var(--card)}

.main{padding:24px;max-width:1100px;margin:0 auto}
.page{display:none}.page.on{display:block}

/* CARDS */
.card{background:var(--card);border-radius:var(--radius);border:1px solid var(--bdr);padding:16px 18px;transition:border-color .15s}
.card:hover{border-color:var(--bdr2)}
.grid4{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
.grid3{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
.stack{display:flex;flex-direction:column;gap:8px}
.section{font-size:10px;letter-spacing:3px;color:var(--tx3);font-weight:500;margin:24px 0 12px}
.section:first-child{margin-top:0}

/* STAT CARDS */
.stat{border-left:3px solid var(--mint)}
.stat .s-label{font-size:10px;color:var(--tx3);letter-spacing:2px;margin-bottom:6px}
.stat .s-val{font-family:var(--sans);font-size:28px;font-weight:800}
.stat .s-sub{font-size:10px;color:var(--tx2);margin-top:4px}
.stat .s-delta{font-size:10px;margin-top:2px}
.s-up{color:var(--mint)}.s-down{color:var(--red)}.s-flat{color:var(--tx3)}

/* BUTTONS */
.btn{padding:8px 16px;background:var(--mint);color:var(--bg);border:none;border-radius:var(--radius-sm);font-family:var(--mono);font-size:10px;letter-spacing:1.5px;font-weight:500;cursor:pointer;transition:opacity .15s}
.btn:hover{opacity:.85}
.btn-coral{background:var(--coral);color:var(--bg)}
.btn-lilac{background:var(--lilac);color:var(--bg)}
.btn-sm{background:transparent;border:1px solid var(--bdr);color:var(--tx3);padding:3px 8px;border-radius:4px;font-size:9px;cursor:pointer;font-family:var(--mono);letter-spacing:1px;transition:all .15s}
.btn-sm:hover{border-color:var(--tx2);color:var(--tx2)}
.btn-x{background:transparent;border:1px solid var(--red2);color:var(--red);padding:3px 8px;border-radius:4px;font-size:9px;cursor:pointer;font-family:var(--mono)}
.btn-x:hover{border-color:var(--red)}
.filter-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;flex-wrap:wrap;gap:10px}
.filters{display:flex;gap:4px;flex-wrap:wrap}
.fbtn{padding:5px 11px;background:var(--card2);color:var(--tx3);border:none;border-radius:4px;font-size:10px;letter-spacing:1px;cursor:pointer;font-family:var(--mono);transition:all .15s}
.fbtn.on{font-weight:500}

/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(6,6,14,.88);display:none;align-items:center;justify-content:center;z-index:999;padding:20px}
.modal-bg.on{display:flex}
.modal{background:var(--card);border-radius:16px;border:1px solid var(--bdr2);padding:26px;width:100%;max-width:480px;max-height:80vh;overflow-y:auto;animation:slideUp .2s}
@keyframes slideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.modal-title{font-size:10px;letter-spacing:3px;color:var(--mint);margin-bottom:20px;font-weight:500}
.field{margin-bottom:14px}
.field-label{font-size:10px;color:var(--tx3);letter-spacing:1px;margin-bottom:5px;display:block}
.field-input,.field-select,.field-textarea{width:100%;background:var(--bg);border:1px solid var(--bdr);border-radius:var(--radius-sm);padding:10px 14px;color:var(--tx);font-family:var(--mono);font-size:12px;outline:none;transition:border-color .15s}
.field-input:focus,.field-select:focus,.field-textarea:focus{border-color:var(--mint)}
.field-select{cursor:pointer}
.field-textarea{resize:vertical;min-height:60px}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.field-check{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:11px;color:var(--lilac);letter-spacing:1px;margin-bottom:14px}
.submit{width:100%;padding:12px;border:none;border-radius:var(--radius-sm);font-family:var(--mono);font-size:11px;letter-spacing:2px;font-weight:500;cursor:pointer;transition:opacity .15s;color:var(--bg)}
.submit:hover{opacity:.85}

/* ROW */
.row{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.row-main{flex:1;min-width:160px}
.row-title{font-family:var(--sans);font-size:14px;font-weight:700;color:#fff;margin-bottom:2px}
.row-sub{font-size:11px;color:var(--tx2)}
.row-notes{font-size:11px;color:var(--tx3);width:100%;margin-top:4px;opacity:.65}
.row-actions{display:flex;gap:6px}

/* LOGO */
.firm-logo{width:28px;height:28px;border-radius:6px;background:var(--card2);object-fit:contain;flex-shrink:0}
.firm-logo-lg{width:36px;height:36px;border-radius:8px;background:var(--card2);object-fit:contain;flex-shrink:0}

/* AVATAR */
.avatar{width:34px;height:34px;border-radius:50%;background:var(--card2);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0;font-family:var(--sans)}

/* KIRBY */
.kirby-zone{display:flex;flex-direction:column;align-items:center;margin:20px 0 28px}
.kirby-msg{font-family:var(--sans);font-size:13px;color:var(--tx2);margin-top:14px;text-align:center}
.kirby-msg em{color:var(--coral);font-style:normal;font-weight:700}

/* STUDY MATERIALS */
.mat-card{cursor:pointer;transition:all .15s;position:relative}
.mat-card:hover{border-color:var(--mint);transform:translateY(-1px)}
.mat-card .mat-logo{width:40px;height:40px;border-radius:8px;background:var(--card2);display:flex;align-items:center;justify-content:center;font-size:18px;margin-bottom:10px;object-fit:contain}
.mat-card .mat-name{font-family:var(--sans);font-size:13px;font-weight:700;color:#fff;margin-bottom:2px}
.mat-card .mat-type{font-size:10px;color:var(--tx3);letter-spacing:1px}
.mat-card .mat-count{position:absolute;top:12px;right:14px;font-family:var(--sans);font-size:20px;font-weight:800;color:var(--mint)}

/* ACTION ITEMS */
.action{display:flex;align-items:center;gap:12px;padding:10px 0}
.action-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.action-text{font-size:12px;color:var(--tx2);flex:1}
.action-type{font-size:9px;color:var(--tx3);letter-spacing:1px;text-transform:uppercase;flex-shrink:0}

/* TOAST */
.toast{position:fixed;bottom:20px;right:20px;background:var(--mint);color:var(--bg);padding:8px 16px;border-radius:var(--radius-sm);font-size:11px;font-weight:500;letter-spacing:1px;z-index:1000;animation:slideUp .2s;display:none}
.toast.on{display:block}

/* EMPTY */
.empty{background:var(--card);border-radius:var(--radius);border:1px dashed var(--bdr);padding:36px;text-align:center;font-size:12px;color:var(--tx3)}

/* LOG MODAL */
.log-history{margin-top:16px;max-height:200px;overflow-y:auto}
.log-entry{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--bdr);font-size:11px;color:var(--tx2)}
.log-entry:last-child{border-bottom:none}

/* STATUS COLORS */
.st-researching{background:#6b728222;color:#9ca3af;border-color:#6b728244}
.st-applied{background:var(--sky2);color:var(--sky);border-color:#7dc4ff44}
.st-oa{background:var(--lilac2);color:var(--lilac);border-color:#c4a8ff44}
.st-interview{background:var(--amber2);color:var(--amber);border-color:#ffd07d44}
.st-final{background:#ff8fab22;color:var(--coral);border-color:#ff8fab44}
.st-offer{background:var(--mint2);color:var(--mint);border-color:#7dffc444}
.st-rejected{background:var(--red2);color:var(--red);border-color:#ff6b8a44}
.st-withdrawn{background:#66668822;color:var(--tx3);border-color:#66668844}

.status-sel{border-radius:4px;padding:4px 8px;font-size:10px;letter-spacing:1px;font-family:var(--mono);cursor:pointer;font-weight:500;outline:none;border-width:1px;border-style:solid}

@media(max-width:600px){
  .main{padding:16px}
  .header{padding:14px 16px}
  .grid4{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<!-- AUTH SCREEN -->
<div id="auth">
  <div class="auth-box">
    <div class="auth-kirby" id="auth-kirby"></div>
    <div class="auth-label">COMMAND CENTER</div>
    <input class="auth-input" id="pw" type="password" placeholder="Â· Â· Â· Â· Â·" autofocus/>
    <div class="auth-err" id="pw-err"></div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <div class="header">
    <div class="header-left">
      <div class="h-label">QUANT RECRUITING</div>
      <div class="h-title">Command Center</div>
    </div>
    <div class="header-right">
      PRINCETON ORFE '28<br/><span>TARGET: SUMMER 2027</span>
    </div>
  </div>

  <div class="tabs">
    <button class="tab on" data-tab="overview">â—ˆ OVERVIEW</button>
    <button class="tab" data-tab="apps">â—‰ APPS</button>
    <button class="tab" data-tab="network">â—Ž NETWORK</button>
    <button class="tab" data-tab="learn">â—‡ LEARNING</button>
    <button class="tab" data-tab="papers">â—† PAPERS</button>
  </div>

  <div class="main">
    <!-- OVERVIEW -->
    <div class="page on" id="p-overview"></div>
    <!-- APPLICATIONS -->
    <div class="page" id="p-apps"></div>
    <!-- NETWORKING -->
    <div class="page" id="p-network"></div>
    <!-- LEARNING -->
    <div class="page" id="p-learn"></div>
    <!-- PAPERS -->
    <div class="page" id="p-papers"></div>
  </div>
</div>

<!-- MODAL CONTAINER -->
<div class="modal-bg" id="modal-bg">
  <div class="modal" id="modal-content"></div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// DATA & CONFIG
// ============================================================
const STORE_KEY = 'qrt_data_v3';
const PW_HASH = '9c0e'; // simple hash of password - change this

const FIRM_DOMAINS = {
  'Jane Street':'janestreet.com','Citadel':'citadel.com','Citadel Securities':'citadelsecurities.com',
  'HRT':'hudsonrivertrading.com','Hudson River Trading':'hudsonrivertrading.com',
  'Two Sigma':'twosigma.com','DE Shaw':'deshaw.com','D.E. Shaw':'deshaw.com',
  'Jump Trading':'jumptrading.com','SIG':'sig.com','Susquehanna':'sig.com',
  'Optiver':'optiver.com','IMC':'imc.com','Akuna Capital':'akunacapital.com',
  'Wolverine':'wolve.com','Point72':'point72.com','Cubist':'point72.com',
  'Millennium':'mlp.com','Balyasny':'balyasny.com','AQR':'aqr.com',
  'Man Group':'man.com','JPMorgan':'jpmorgan.com','Goldman Sachs':'goldmansachs.com',
  'Morgan Stanley':'morganstanley.com','Bridgewater':'bridgewater.com',
  'Renaissance':'rentec.com','Tower Research':'tower-research.com',
  'Virtu':'virtu.com','Flow Traders':'flowtraders.com','DRW':'drw.com',
  'Five Rings':'fiverings.com','Squarepoint':'squarepoint-capital.com',
  'Qube Research':'qube-rt.com','Marshall Wace':'mwam.com',
  'WorldQuant':'worldquant.com','Voleon':'voleon.com',
  'Old Mission':'oldmissioncapital.com','Headlands':'headlandstech.com'
};

const STATUS_LIST = ['Researching','Applied','OA/Screen','Interview','Final Round','Offer','Rejected','Withdrawn'];
const STATUS_CLASS = {'Researching':'st-researching','Applied':'st-applied','OA/Screen':'st-oa','Interview':'st-interview','Final Round':'st-final','Offer':'st-offer','Rejected':'st-rejected','Withdrawn':'st-withdrawn'};
const STATUS_COLORS_MAP = {'Researching':'#9ca3af','Applied':'#7dc4ff','OA/Screen':'#c4a8ff','Interview':'#ffd07d','Final Round':'#ff8fab','Offer':'#7dffc4','Rejected':'#ff6b8a','Withdrawn':'#666688'};
const ROLE_TYPES = ['Quant Trading','Quant Research','Quant Dev','SWE','Other'];
const CONTACT_TYPES = ['Princeton Alum','Recruiter','Employee','Professor','Peer'];

const DEFAULT_MATERIALS = [
  {id:'green-book',name:'Green Book (Zhou)',type:'Probability',icon:'ðŸ“—',problems:0,logs:[]},
  {id:'leetcode',name:'LeetCode / Neetcode 150',type:'Coding',icon:'ðŸŸ¡',problems:0,logs:[]},
  {id:'openquant',name:'OpenQuant',type:'Quant Practice',icon:'ðŸ§®',problems:0,logs:[]},
  {id:'zetamac',name:'Zetamac',type:'Mental Math',icon:'âš¡',problems:0,logs:[]},
  {id:'stefanica-150',name:'150 Most FAQ (Stefanica)',type:'Probability',icon:'ðŸ“™',problems:0,logs:[]},
  {id:'stefanica-stoch',name:'Prob & Stoch Calc (Stefanica)',type:'Stochastic Calc',icon:'ðŸ“',problems:0,logs:[]},
  {id:'heard-street',name:'Heard on the Street',type:'Brainteasers',icon:'ðŸ“˜',problems:0,logs:[]},
  {id:'fifty-prob',name:'50 Challenging Problems',type:'Probability',icon:'ðŸ“•',problems:0,logs:[]},
];

let DATA = {
  applications: [],
  contacts: [],
  materials: [...DEFAULT_MATERIALS],
  papers: [],
  actionItems: [],
  weekHistory: []
};

function load() {
  try {
    const raw = localStorage.getItem(STORE_KEY);
    if (raw) {
      const parsed = JSON.parse(raw);
      DATA = { ...DATA, ...parsed };
      // ensure materials have logs array
      DATA.materials.forEach(m => { if (!m.logs) m.logs = []; });
    }
  } catch(e) {}
}
function save() {
  try {
    localStorage.setItem(STORE_KEY, JSON.stringify(DATA));
    showToast('Saved');
  } catch(e) { showToast('Save failed'); }
}

function simpleHash(s) {
  let h = 0;
  for (let i = 0; i < s.length; i++) { h = ((h << 5) - h + s.charCodeAt(i)) | 0; }
  return (h >>> 0).toString(16).slice(-4);
}

function getFirmLogo(name) {
  const domain = FIRM_DOMAINS[name];
  if (domain) return `https://logo.clearbit.com/${domain}`;
  // try to guess
  const guess = name.toLowerCase().replace(/[^a-z0-9]/g,'') + '.com';
  return `https://logo.clearbit.com/${guess}`;
}

function getWeekKey(date) {
  const d = new Date(date || Date.now());
  const jan1 = new Date(d.getFullYear(), 0, 1);
  const week = Math.ceil(((d - jan1) / 86400000 + jan1.getDay() + 1) / 7);
  return `${d.getFullYear()}-W${week}`;
}

function getThisWeekProblems() {
  const key = getWeekKey();
  let total = 0;
  DATA.materials.forEach(m => {
    (m.logs || []).forEach(l => {
      if (getWeekKey(l.date) === key) total += l.count;
    });
  });
  return total;
}

function getLastWeekProblems() {
  const now = new Date();
  const lastWeek = new Date(now - 7 * 86400000);
  const key = getWeekKey(lastWeek);
  let total = 0;
  DATA.materials.forEach(m => {
    (m.logs || []).forEach(l => {
      if (getWeekKey(l.date) === key) total += l.count;
    });
  });
  return total;
}

function getThisWeekByMaterial(matId) {
  const key = getWeekKey();
  const mat = DATA.materials.find(m => m.id === matId);
  if (!mat) return 0;
  return (mat.logs || []).filter(l => getWeekKey(l.date) === key).reduce((s,l) => s + l.count, 0);
}

function getLastWeekByMaterial(matId) {
  const now = new Date();
  const lastWeek = new Date(now - 7 * 86400000);
  const key = getWeekKey(lastWeek);
  const mat = DATA.materials.find(m => m.id === matId);
  if (!mat) return 0;
  return (mat.logs || []).filter(l => getWeekKey(l.date) === key).reduce((s,l) => s + l.count, 0);
}

function getAllTimeProblems() {
  let total = 0;
  DATA.materials.forEach(m => {
    (m.logs || []).forEach(l => { total += l.count; });
  });
  return total;
}

function getAllTimeByMaterial(matId) {
  const mat = DATA.materials.find(m => m.id === matId);
  if (!mat) return 0;
  return (mat.logs || []).reduce((s,l) => s + l.count, 0);
}

// ============================================================
// KIRBY SVG
// ============================================================
function kirbyHTML(size, happy) {
  // size: 60 to 160 px based on activity
  const s = Math.max(60, Math.min(160, size));
  const r = s / 2;
  const eyeR = s * 0.06;
  const eyeY = r * 0.82;
  const eyeSpread = r * 0.32;
  const blushR = s * 0.07;
  const blushY = r * 1.05;
  const blushSpread = r * 0.52;
  const footW = s * 0.22;
  const footH = s * 0.12;
  const mouthW = happy ? s * 0.12 : s * 0.06;
  const svgS = s + 30;
  const cx = svgS / 2;
  const cy = svgS / 2 - 4;

  return `<svg width="${svgS}" height="${svgS + 10}" viewBox="0 0 ${svgS} ${svgS + 10}">
    <!-- body -->
    <circle cx="${cx}" cy="${cy}" r="${r}" fill="var(--coral)" opacity="0.9"/>
    <circle cx="${cx}" cy="${cy}" r="${r * 0.92}" fill="none" stroke="#ff6b8a" stroke-width="0.5" opacity="0.3"/>
    <!-- eyes -->
    <ellipse cx="${cx - eyeSpread}" cy="${cy - r + eyeY}" rx="${eyeR}" ry="${eyeR * 1.2}" fill="#1a1a32"/>
    <ellipse cx="${cx + eyeSpread}" cy="${cy - r + eyeY}" rx="${eyeR}" ry="${eyeR * 1.2}" fill="#1a1a32"/>
    <!-- eye highlights -->
    <circle cx="${cx - eyeSpread + eyeR * 0.3}" cy="${cy - r + eyeY - eyeR * 0.4}" r="${eyeR * 0.35}" fill="white" opacity="0.9"/>
    <circle cx="${cx + eyeSpread + eyeR * 0.3}" cy="${cy - r + eyeY - eyeR * 0.4}" r="${eyeR * 0.35}" fill="white" opacity="0.9"/>
    <!-- blush -->
    <ellipse cx="${cx - blushSpread}" cy="${cy - r + blushY}" rx="${blushR}" ry="${blushR * 0.65}" fill="#ff6b8a" opacity="0.5"/>
    <ellipse cx="${cx + blushSpread}" cy="${cy - r + blushY}" rx="${blushR}" ry="${blushR * 0.65}" fill="#ff6b8a" opacity="0.5"/>
    <!-- mouth -->
    ${happy
      ? `<path d="M ${cx - mouthW} ${cy - r + blushY - s*0.06} Q ${cx} ${cy - r + blushY + s*0.08} ${cx + mouthW} ${cy - r + blushY - s*0.06}" fill="none" stroke="#1a1a32" stroke-width="${s*0.02}" stroke-linecap="round"/>`
      : `<ellipse cx="${cx}" cy="${cy - r + blushY - s*0.02}" rx="${mouthW}" ry="${s*0.03}" fill="#1a1a32" opacity="0.7"/>`
    }
    <!-- feet -->
    <ellipse cx="${cx - r * 0.38}" cy="${cy + r - 2}" rx="${footW}" ry="${footH}" fill="#ff6b8a" opacity="0.7"/>
    <ellipse cx="${cx + r * 0.38}" cy="${cy + r - 2}" rx="${footW}" ry="${footH}" fill="#ff6b8a" opacity="0.7"/>
  </svg>`;
}

function getKirbySize() {
  const problems = getAllTimeProblems();
  // 0 problems = 60px, 500+ = 160px
  return 60 + Math.min(100, problems * 0.2);
}

function getKirbyMessage() {
  const p = getAllTimeProblems();
  if (p === 0) return "feed me problems... i'm <em>smol</em>";
  if (p < 50) return `${p} problems total. i'm growing! <em>keep going~</em>`;
  if (p < 150) return `${p} problems! i'm getting <em>chonky</em> ðŸŽ€`;
  if (p < 300) return `${p} problems!! i'm <em>MEGA KIRBY</em> now âœ¨`;
  return `${p} problems!!! i've reached <em>FINAL FORM</em> ðŸ’«`;
}

// ============================================================
// TOAST
// ============================================================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('on');
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.classList.remove('on'), 2000);
}

// ============================================================
// MODAL
// ============================================================
function openModal(html) {
  document.getElementById('modal-content').innerHTML = html;
  document.getElementById('modal-bg').classList.add('on');
}
function closeModal() {
  document.getElementById('modal-bg').classList.remove('on');
}
document.addEventListener('click', e => {
  if (e.target.id === 'modal-bg') closeModal();
});

// ============================================================
// RENDER: OVERVIEW
// ============================================================
function renderOverview() {
  const el = document.getElementById('p-overview');
  const apps = DATA.applications.length;
  const contacts = DATA.contacts.length;
  const allTime = getAllTimeProblems();
  const thisWeek = getThisWeekProblems();
  const inProgress = DATA.papers.filter(p => p.status === 'Reading' || p.status === 'In Progress').length;
  const pipeline = DATA.applications.filter(a => ['OA/Screen','Interview','Final Round'].includes(a.status)).length;
  const contactFollowUps = DATA.contacts.filter(c => c.followUp).length;

  const deltaStr = thisWeek > 0 ? `<span class="s-up">+${thisWeek} this week</span>` : `<span class="s-flat">0 this week</span>`;

  // Action items
  let actions = [];
  DATA.contacts.filter(c => c.followUp).forEach(c => {
    actions.push({ text: `Follow up with ${c.name} at ${c.firm}`, type: 'network', priority: 'high' });
  });
  DATA.applications.filter(a => ['OA/Screen','Interview','Final Round'].includes(a.status)).forEach(a => {
    actions.push({ text: `${a.status}: ${a.firm} â€” ${a.role}`, type: 'app', priority: 'high' });
  });
  DATA.papers.filter(p => p.status === 'In Progress' || p.status === 'Reading').forEach(p => {
    actions.push({ text: `Continue: "${p.title}"`, type: 'paper', priority: 'med' });
  });
  DATA.actionItems.forEach(a => {
    actions.push({ text: a.text, type: 'custom', priority: a.priority || 'med' });
  });

  el.innerHTML = `
    <div class="kirby-zone">
      ${kirbyHTML(getKirbySize(), allTime > 5)}
      <div class="kirby-msg">${getKirbyMessage()}</div>
    </div>

    <div class="grid4" style="margin-bottom:24px">
      <div class="card stat" style="border-left-color:var(--sky)">
        <div class="s-label">APPLICATIONS</div>
        <div class="s-val" style="color:var(--sky)">${apps}</div>
        <div class="s-sub">${pipeline} in pipeline</div>
      </div>
      <div class="card stat" style="border-left-color:var(--lilac)">
        <div class="s-label">CONTACTS</div>
        <div class="s-val" style="color:var(--lilac)">${contacts}</div>
        <div class="s-sub">${contactFollowUps} need follow-up</div>
      </div>
      <div class="card stat" style="border-left-color:var(--mint)">
        <div class="s-label">PROBLEMS SOLVED</div>
        <div class="s-val" style="color:var(--mint)">${allTime}</div>
        <div class="s-delta">${deltaStr}</div>
      </div>
      <div class="card stat" style="border-left-color:var(--coral)">
        <div class="s-label">PROJECTS IN PROGRESS</div>
        <div class="s-val" style="color:var(--coral)">${inProgress}</div>
        <div class="s-sub">${DATA.papers.filter(p=>p.status==='Implemented').length} implemented</div>
      </div>
    </div>

    <div class="section">ACTION ITEMS</div>
    <div class="card" style="margin-bottom:12px">
      ${actions.length ? actions.slice(0, 10).map((a, i) => `
        <div class="action" style="${i < actions.length - 1 ? 'border-bottom:1px solid var(--bdr)' : ''}">
          <div class="action-dot" style="background:${a.priority === 'high' ? 'var(--red)' : 'var(--amber)'}"></div>
          <div class="action-text">${a.text}</div>
          <div class="action-type">${a.type}</div>
        </div>
      `).join('') : '<div style="padding:20px;text-align:center;font-size:12px;color:var(--tx3)">No pending actions. Keep building!</div>'}
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn" onclick="openAddAction()" style="font-size:9px;padding:6px 12px">+ ACTION ITEM</button>
    </div>

    <div class="section">PROGRESS BREAKDOWN</div>
    <div class="grid4">
      ${DATA.materials.map(m => {
        const at = getAllTimeByMaterial(m.id);
        const tw = getThisWeekByMaterial(m.id);
        return `<div class="card" style="padding:12px 14px">
          <div style="font-size:10px;color:var(--tx3);letter-spacing:1px;margin-bottom:4px">${m.icon} ${m.name}</div>
          <div style="display:flex;align-items:baseline;gap:8px">
            <span style="font-family:var(--sans);font-size:18px;font-weight:700;color:var(--mint)">${at}</span>
            <span style="font-size:10px;color:var(--tx3)">total</span>
          </div>
          <div style="font-size:10px;color:var(--tx3);margin-top:2px">+${tw} this wk</div>
        </div>`;
      }).join('')}
    </div>
  `;
}

function openAddAction() {
  openModal(`
    <div class="modal-title">ADD ACTION ITEM</div>
    <div class="field">
      <label class="field-label">WHAT NEEDS DOING?</label>
      <input class="field-input" id="ai-text" placeholder="e.g. Finish LC hard on trees"/>
    </div>
    <div class="field">
      <label class="field-label">PRIORITY</label>
      <select class="field-select" id="ai-priority">
        <option value="high">High</option>
        <option value="med" selected>Medium</option>
      </select>
    </div>
    <button class="submit" style="background:var(--mint)" onclick="addAction()">ADD</button>
  `);
}

function addAction() {
  const text = document.getElementById('ai-text').value.trim();
  const priority = document.getElementById('ai-priority').value;
  if (!text) return;
  DATA.actionItems.push({ id: Date.now(), text, priority });
  save(); closeModal(); renderOverview();
}

// ============================================================
// RENDER: APPLICATIONS
// ============================================================
function renderApps() {
  const el = document.getElementById('p-apps');
  const apps = DATA.applications;

  el.innerHTML = `
    <div class="filter-bar">
      <div class="filters" id="app-filters">
        <button class="fbtn on" data-f="All" style="background:var(--sky);color:var(--bg)">ALL</button>
        ${STATUS_LIST.map(s => `<button class="fbtn" data-f="${s}">${s.toUpperCase()}</button>`).join('')}
      </div>
      <button class="btn" onclick="openAppModal()">+ APPLICATION</button>
    </div>
    <div class="stack" id="app-list"></div>
  `;

  renderAppList('All');

  el.querySelectorAll('#app-filters .fbtn').forEach(btn => {
    btn.addEventListener('click', () => {
      el.querySelectorAll('#app-filters .fbtn').forEach(b => { b.classList.remove('on'); b.style.background = 'var(--card2)'; b.style.color = 'var(--tx3)'; });
      btn.classList.add('on');
      btn.style.background = 'var(--sky)';
      btn.style.color = 'var(--bg)';
      renderAppList(btn.dataset.f);
    });
  });
}

function renderAppList(filter) {
  const list = document.getElementById('app-list');
  let apps = filter === 'All' ? DATA.applications : DATA.applications.filter(a => a.status === filter);
  apps = apps.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

  if (!apps.length) {
    list.innerHTML = '<div class="empty">No applications yet. Start targeting firms!</div>';
    return;
  }

  list.innerHTML = apps.map(a => `
    <div class="card row">
      <img class="firm-logo-lg" src="${getFirmLogo(a.firm)}" onerror="this.style.display='none'" alt=""/>
      <div class="row-main">
        <div class="row-title">${esc(a.firm)}</div>
        <div class="row-sub">${esc(a.role)}${a.connection ? ' Â· via ' + esc(a.connection) : ''}</div>
      </div>
      <select class="status-sel ${STATUS_CLASS[a.status]}" onchange="updateAppStatus(${a.id}, this.value)" style="border-width:1px;border-style:solid">
        ${STATUS_LIST.map(s => `<option value="${s}" ${a.status === s ? 'selected' : ''}>${s}</option>`).join('')}
      </select>
      ${a.appliedDate ? `<div style="font-size:10px;color:var(--tx3)">${a.appliedDate}</div>` : ''}
      <div class="row-actions">
        <button class="btn-sm" onclick="openAppModal(${a.id})">EDIT</button>
        <button class="btn-x" onclick="deleteApp(${a.id})">Ã—</button>
      </div>
      ${a.notes ? `<div class="row-notes">${esc(a.notes)}</div>` : ''}
    </div>
  `).join('');
}

function openAppModal(id) {
  const a = id ? DATA.applications.find(x => x.id === id) : null;
  const firmOptions = Object.keys(FIRM_DOMAINS).map(f => `<option value="${f}">${f}</option>`).join('');

  openModal(`
    <div class="modal-title">${a ? 'EDIT' : 'NEW'} APPLICATION</div>
    <div class="field">
      <label class="field-label">FIRM</label>
      <input class="field-input" id="app-firm" value="${a ? esc(a.firm) : ''}" placeholder="Type or select..." list="firm-list"/>
      <datalist id="firm-list">${firmOptions}</datalist>
    </div>
    <div style="margin:-8px 0 14px;display:flex;gap:4px;flex-wrap:wrap">
      ${['Jane Street','Citadel Securities','Two Sigma','HRT','DE Shaw','Jump Trading','Optiver','SIG','IMC','Point72','AQR'].map(f => `<button class="fbtn" style="font-size:9px;padding:3px 8px" onclick="document.getElementById('app-firm').value='${f}'">${f}</button>`).join('')}
    </div>
    <div class="field">
      <label class="field-label">ROLE</label>
      <select class="field-select" id="app-role">
        <option value="">Select...</option>
        ${ROLE_TYPES.map(r => `<option value="${r}" ${a && a.role === r ? 'selected' : ''}>${r}</option>`).join('')}
      </select>
    </div>
    <div class="field-row">
      <div class="field">
        <label class="field-label">STATUS</label>
        <select class="field-select" id="app-status">
          ${STATUS_LIST.map(s => `<option value="${s}" ${a && a.status === s ? 'selected' : ''}>${s}</option>`).join('')}
        </select>
      </div>
      <div class="field">
        <label class="field-label">APPLIED DATE</label>
        <input class="field-input" id="app-date" type="date" value="${a ? a.appliedDate || '' : ''}"/>
      </div>
    </div>
    <div class="field">
      <label class="field-label">CONNECTION / REFERRAL</label>
      <input class="field-input" id="app-conn" value="${a ? esc(a.connection || '') : ''}" placeholder="e.g. John Smith (Princeton '24)"/>
    </div>
    <div class="field">
      <label class="field-label">NOTES</label>
      <textarea class="field-textarea" id="app-notes" placeholder="Interview dates, prep notes...">${a ? esc(a.notes || '') : ''}</textarea>
    </div>
    <button class="submit" style="background:var(--sky)" onclick="saveApp(${id || 0})">${a ? 'UPDATE' : 'ADD APPLICATION'}</button>
  `);
}

function saveApp(id) {
  const firm = document.getElementById('app-firm').value.trim();
  const role = document.getElementById('app-role').value;
  const status = document.getElementById('app-status').value;
  const appliedDate = document.getElementById('app-date').value;
  const connection = document.getElementById('app-conn').value.trim();
  const notes = document.getElementById('app-notes').value.trim();
  if (!firm) return;

  if (id) {
    const a = DATA.applications.find(x => x.id === id);
    if (a) Object.assign(a, { firm, role, status, appliedDate, connection, notes });
  } else {
    DATA.applications.push({ id: Date.now(), firm, role, status, appliedDate, connection, notes, createdAt: Date.now() });
  }
  save(); closeModal(); renderApps(); renderOverview();
}

function updateAppStatus(id, status) {
  const a = DATA.applications.find(x => x.id === id);
  if (a) { a.status = status; save(); renderApps(); renderOverview(); }
}

function deleteApp(id) {
  DATA.applications = DATA.applications.filter(x => x.id !== id);
  save(); renderApps(); renderOverview();
}

// ============================================================
// RENDER: NETWORKING
// ============================================================
function renderNetwork() {
  const el = document.getElementById('p-network');
  el.innerHTML = `
    <div class="filter-bar">
      <div class="filters" id="net-filters">
        <button class="fbtn on" data-f="All" style="background:var(--lilac);color:var(--bg)">ALL</button>
        ${CONTACT_TYPES.map(t => `<button class="fbtn" data-f="${t}">${t.toUpperCase()}</button>`).join('')}
      </div>
      <button class="btn btn-lilac" onclick="openContactModal()">+ CONTACT</button>
    </div>
    <div class="stack" id="net-list"></div>
  `;

  renderNetList('All');

  el.querySelectorAll('#net-filters .fbtn').forEach(btn => {
    btn.addEventListener('click', () => {
      el.querySelectorAll('#net-filters .fbtn').forEach(b => { b.classList.remove('on'); b.style.background = 'var(--card2)'; b.style.color = 'var(--tx3)'; });
      btn.classList.add('on'); btn.style.background = 'var(--lilac)'; btn.style.color = 'var(--bg)';
      renderNetList(btn.dataset.f);
    });
  });
}

function renderNetList(filter) {
  const list = document.getElementById('net-list');
  let contacts = filter === 'All' ? DATA.contacts : DATA.contacts.filter(c => c.type === filter);
  contacts = contacts.sort((a, b) => (a.followUp === b.followUp ? 0 : a.followUp ? -1 : 1));

  if (!contacts.length) {
    list.innerHTML = '<div class="empty">No contacts yet. Start building your network!</div>';
    return;
  }

  list.innerHTML = contacts.map(c => `
    <div class="card row" style="${c.followUp ? 'border-color:var(--lilac);border-opacity:0.3' : ''}">
      <div class="avatar" style="color:var(--lilac)">${(c.name || '?')[0].toUpperCase()}</div>
      <div class="row-main">
        <div class="row-title">${esc(c.name)}</div>
        <div class="row-sub">${esc(c.role || '')} Â· ${esc(c.firm || '')}</div>
      </div>
      <div style="font-size:10px;color:var(--tx3);letter-spacing:1px">${(c.type || '').toUpperCase()}</div>
      ${c.followUp ? '<div class="tag" style="background:var(--lilac2);color:var(--lilac)">FOLLOW UP</div>' : ''}
      ${c.lastContact ? `<div style="font-size:10px;color:var(--tx3)">Last: ${c.lastContact}</div>` : ''}
      <div class="row-actions">
        <button class="btn-sm" onclick="openContactModal(${c.id})">EDIT</button>
        <button class="btn-x" onclick="deleteContact(${c.id})">Ã—</button>
      </div>
      ${c.notes ? `<div class="row-notes">${esc(c.notes)}</div>` : ''}
    </div>
  `).join('');
}

function openContactModal(id) {
  const c = id ? DATA.contacts.find(x => x.id === id) : null;
  openModal(`
    <div class="modal-title">${c ? 'EDIT' : 'NEW'} CONTACT</div>
    <div class="field"><label class="field-label">NAME</label><input class="field-input" id="ct-name" value="${c ? esc(c.name) : ''}" placeholder="Full name"/></div>
    <div class="field"><label class="field-label">ROLE / TITLE</label><input class="field-input" id="ct-role" value="${c ? esc(c.role || '') : ''}" placeholder="e.g. Quant Researcher"/></div>
    <div class="field"><label class="field-label">FIRM</label><input class="field-input" id="ct-firm" value="${c ? esc(c.firm || '') : ''}" placeholder="e.g. Two Sigma"/></div>
    <div class="field"><label class="field-label">CONNECTION TYPE</label><select class="field-select" id="ct-type"><option value="">Select...</option>${CONTACT_TYPES.map(t => `<option value="${t}" ${c && c.type === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div>
    <div class="field"><label class="field-label">LAST CONTACT</label><input class="field-input" id="ct-last" type="date" value="${c ? c.lastContact || '' : ''}"/></div>
    <label class="field-check"><input type="checkbox" id="ct-fu" ${c && c.followUp ? 'checked' : ''}/> NEEDS FOLLOW-UP</label>
    <div class="field"><label class="field-label">NOTES</label><textarea class="field-textarea" id="ct-notes" placeholder="How you connected, conversation topics...">${c ? esc(c.notes || '') : ''}</textarea></div>
    <button class="submit" style="background:var(--lilac)" onclick="saveContact(${id || 0})">${c ? 'UPDATE' : 'ADD CONTACT'}</button>
  `);
}

function saveContact(id) {
  const name = document.getElementById('ct-name').value.trim();
  const role = document.getElementById('ct-role').value.trim();
  const firm = document.getElementById('ct-firm').value.trim();
  const type = document.getElementById('ct-type').value;
  const lastContact = document.getElementById('ct-last').value;
  const followUp = document.getElementById('ct-fu').checked;
  const notes = document.getElementById('ct-notes').value.trim();
  if (!name) return;

  if (id) {
    const c = DATA.contacts.find(x => x.id === id);
    if (c) Object.assign(c, { name, role, firm, type, lastContact, followUp, notes });
  } else {
    DATA.contacts.push({ id: Date.now(), name, role, firm, type, lastContact, followUp, notes, createdAt: Date.now() });
  }
  save(); closeModal(); renderNetwork(); renderOverview();
}

function deleteContact(id) {
  DATA.contacts = DATA.contacts.filter(x => x.id !== id);
  save(); renderNetwork(); renderOverview();
}

// ============================================================
// RENDER: LEARNING
// ============================================================
function renderLearn() {
  const el = document.getElementById('p-learn');

  el.innerHTML = `
    <div class="filter-bar">
      <div class="section" style="margin:0">STUDY MATERIALS</div>
      <button class="btn" onclick="openMatModal()">+ MATERIAL</button>
    </div>
    <div class="grid3" id="mat-grid"></div>
  `;

  const grid = document.getElementById('mat-grid');
  grid.innerHTML = DATA.materials.map(m => {
    const tw = getThisWeekByMaterial(m.id);
    const total = (m.logs || []).reduce((s, l) => s + l.count, 0);
    return `
      <div class="card mat-card" onclick="openLogModal('${m.id}')">
        <div class="mat-count">${total}</div>
        <div class="mat-logo">${m.icon || 'ðŸ“–'}</div>
        <div class="mat-name">${esc(m.name)}</div>
        <div class="mat-type">${esc(m.type || '')}</div>
        <div style="margin-top:8px;font-size:10px;color:var(--tx3)">+${tw} this week</div>
      </div>
    `;
  }).join('');
}

function openLogModal(matId) {
  const m = DATA.materials.find(x => x.id === matId);
  if (!m) return;
  const today = new Date().toISOString().split('T')[0];
  const recentLogs = (m.logs || []).sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 15);

  openModal(`
    <div class="modal-title">${m.icon} ${esc(m.name)}</div>
    <div class="field-row">
      <div class="field">
        <label class="field-label">DATE</label>
        <input class="field-input" id="log-date" type="date" value="${today}"/>
      </div>
      <div class="field">
        <label class="field-label">PROBLEMS SOLVED</label>
        <input class="field-input" id="log-count" type="number" placeholder="e.g. 5" min="1"/>
      </div>
    </div>
    <button class="submit" style="background:var(--mint);margin-bottom:16px" onclick="addLog('${matId}')">LOG PROBLEMS</button>
    <div class="log-history">
      <div style="font-size:10px;color:var(--tx3);letter-spacing:2px;margin-bottom:8px">RECENT LOGS</div>
      ${recentLogs.length ? recentLogs.map(l => `
        <div class="log-entry">
          <span>${l.date}</span>
          <span style="color:var(--mint);font-weight:500">${l.count} problems</span>
          <button class="btn-x" style="font-size:8px;padding:1px 5px" onclick="deleteLog('${matId}',${l.id})">Ã—</button>
        </div>
      `).join('') : '<div style="font-size:11px;color:var(--tx3);padding:8px 0">No logs yet</div>'}
    </div>
    <div style="margin-top:16px;text-align:right">
      <button class="btn-x" onclick="deleteMaterial('${matId}')" style="font-size:10px;padding:5px 10px">DELETE MATERIAL</button>
    </div>
  `);
}

function addLog(matId) {
  const m = DATA.materials.find(x => x.id === matId);
  if (!m) return;
  const date = document.getElementById('log-date').value;
  const count = parseInt(document.getElementById('log-count').value) || 0;
  if (!count) return;
  if (!m.logs) m.logs = [];
  m.logs.push({ id: Date.now(), date, count });
  save(); openLogModal(matId); renderOverview();
}

function deleteLog(matId, logId) {
  const m = DATA.materials.find(x => x.id === matId);
  if (!m) return;
  m.logs = (m.logs || []).filter(l => l.id !== logId);
  save(); openLogModal(matId); renderOverview();
}

function openMatModal() {
  openModal(`
    <div class="modal-title">ADD STUDY MATERIAL</div>
    <div class="field"><label class="field-label">NAME</label><input class="field-input" id="mat-name" placeholder="e.g. Stochastic Calculus for Finance"/></div>
    <div class="field"><label class="field-label">TYPE</label><select class="field-select" id="mat-type">
      <option value="Probability">Probability</option>
      <option value="Coding">Coding</option>
      <option value="Brainteasers">Brainteasers</option>
      <option value="ML/Finance">ML / Finance</option>
      <option value="Statistics">Statistics</option>
      <option value="Mental Math">Mental Math</option>
      <option value="Other">Other</option>
    </select></div>
    <div class="field"><label class="field-label">ICON (emoji)</label><input class="field-input" id="mat-icon" value="ðŸ“–" maxlength="4"/></div>
    <button class="submit" style="background:var(--mint)" onclick="addMaterial()">ADD MATERIAL</button>
  `);
}

function addMaterial() {
  const name = document.getElementById('mat-name').value.trim();
  const type = document.getElementById('mat-type').value;
  const icon = document.getElementById('mat-icon').value || 'ðŸ“–';
  if (!name) return;
  DATA.materials.push({ id: 'mat-' + Date.now(), name, type, icon, problems: 0, logs: [] });
  save(); closeModal(); renderLearn();
}

function deleteMaterial(matId) {
  DATA.materials = DATA.materials.filter(x => x.id !== matId);
  save(); closeModal(); renderLearn(); renderOverview();
}

// ============================================================
// RENDER: PAPERS
// ============================================================
function renderPapers() {
  const el = document.getElementById('p-papers');
  const PAPER_ST = ['Queued','Reading','In Progress','Implemented','Abandoned'];

  el.innerHTML = `
    <div class="filter-bar">
      <div class="filters" id="paper-filters">
        <button class="fbtn on" data-f="All" style="background:var(--mint);color:var(--bg)">ALL</button>
        ${PAPER_ST.map(s => `<button class="fbtn" data-f="${s}">${s.toUpperCase()}</button>`).join('')}
      </div>
      <button class="btn" onclick="openPaperModal()">+ PAPER</button>
    </div>
    <div class="stack" id="paper-list"></div>
  `;

  renderPaperList('All');

  el.querySelectorAll('#paper-filters .fbtn').forEach(btn => {
    btn.addEventListener('click', () => {
      el.querySelectorAll('#paper-filters .fbtn').forEach(b => { b.classList.remove('on'); b.style.background = 'var(--card2)'; b.style.color = 'var(--tx3)'; });
      btn.classList.add('on'); btn.style.background = 'var(--mint)'; btn.style.color = 'var(--bg)';
      renderPaperList(btn.dataset.f);
    });
  });
}

function renderPaperList(filter) {
  const PAPER_ST = ['Queued','Reading','In Progress','Implemented','Abandoned'];
  const list = document.getElementById('paper-list');
  let papers = filter === 'All' ? DATA.papers : DATA.papers.filter(p => p.status === filter);

  if (!papers.length) {
    list.innerHTML = '<div class="empty">No papers tracked. Add quant papers you want to implement!</div>';
    return;
  }

  list.innerHTML = papers.map(p => `
    <div class="card">
      <div class="row">
        <div style="font-size:20px;flex-shrink:0">ðŸ“„</div>
        <div class="row-main">
          <div class="row-title">${esc(p.title)}</div>
          <div class="row-sub">${esc(p.authors || '')} ${p.year ? '(' + p.year + ')' : ''}</div>
        </div>
        <select class="field-select" style="width:auto;padding:4px 8px;font-size:10px" onchange="updatePaperStatus(${p.id}, this.value)">
          ${PAPER_ST.map(s => `<option value="${s}" ${p.status === s ? 'selected' : ''}>${s}</option>`).join('')}
        </select>
        <div class="row-actions">
          <button class="btn-sm" onclick="openPaperModal(${p.id})">EDIT</button>
          <button class="btn-x" onclick="deletePaper(${p.id})">Ã—</button>
        </div>
      </div>
      ${p.relevance ? `<div style="font-size:11px;color:var(--tx3);margin-top:8px">â†³ ${esc(p.relevance)}</div>` : ''}
      ${p.notes ? `<div class="row-notes">${esc(p.notes)}</div>` : ''}
    </div>
  `).join('');
}

function openPaperModal(id) {
  const p = id ? DATA.papers.find(x => x.id === id) : null;
  const PAPER_ST = ['Queued','Reading','In Progress','Implemented','Abandoned'];
  openModal(`
    <div class="modal-title">${p ? 'EDIT' : 'TRACK'} PAPER</div>
    <div class="field"><label class="field-label">PAPER TITLE</label><input class="field-input" id="pp-title" value="${p ? esc(p.title) : ''}" placeholder="e.g. Momentum Turning Points"/></div>
    <div class="field"><label class="field-label">AUTHORS</label><input class="field-input" id="pp-auth" value="${p ? esc(p.authors || '') : ''}" placeholder="e.g. Garg, Kim et al."/></div>
    <div class="field-row">
      <div class="field"><label class="field-label">YEAR</label><input class="field-input" id="pp-year" value="${p ? esc(p.year || '') : ''}" placeholder="e.g. 2023"/></div>
      <div class="field"><label class="field-label">STATUS</label><select class="field-select" id="pp-status">${PAPER_ST.map(s => `<option value="${s}" ${p && p.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div>
    </div>
    <div class="field"><label class="field-label">RELEVANCE TO RECRUITING</label><input class="field-input" id="pp-rel" value="${p ? esc(p.relevance || '') : ''}" placeholder="Why this paper? What signal?"/></div>
    <div class="field"><label class="field-label">NOTES</label><textarea class="field-textarea" id="pp-notes" placeholder="Key takeaways, implementation ideas...">${p ? esc(p.notes || '') : ''}</textarea></div>
    <button class="submit" style="background:var(--mint)" onclick="savePaper(${id || 0})">${p ? 'UPDATE' : 'ADD PAPER'}</button>
  `);
}

function savePaper(id) {
  const title = document.getElementById('pp-title').value.trim();
  const authors = document.getElementById('pp-auth').value.trim();
  const year = document.getElementById('pp-year').value.trim();
  const status = document.getElementById('pp-status').value;
  const relevance = document.getElementById('pp-rel').value.trim();
  const notes = document.getElementById('pp-notes').value.trim();
  if (!title) return;

  if (id) {
    const p = DATA.papers.find(x => x.id === id);
    if (p) Object.assign(p, { title, authors, year, status, relevance, notes });
  } else {
    DATA.papers.push({ id: Date.now(), title, authors, year, status, relevance, notes, createdAt: Date.now() });
  }
  save(); closeModal(); renderPapers(); renderOverview();
}

function updatePaperStatus(id, status) {
  const p = DATA.papers.find(x => x.id === id);
  if (p) { p.status = status; save(); renderPapers(); renderOverview(); }
}

function deletePaper(id) {
  DATA.papers = DATA.papers.filter(x => x.id !== id);
  save(); renderPapers(); renderOverview();
}

// ============================================================
// UTILS
// ============================================================
function esc(s) {
  if (!s) return '';
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

// ============================================================
// TAB SWITCHING
// ============================================================
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('on'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
    tab.classList.add('on');
    document.getElementById('p-' + tab.dataset.tab).classList.add('on');

    if (tab.dataset.tab === 'overview') renderOverview();
    else if (tab.dataset.tab === 'apps') renderApps();
    else if (tab.dataset.tab === 'network') renderNetwork();
    else if (tab.dataset.tab === 'learn') renderLearn();
    else if (tab.dataset.tab === 'papers') renderPapers();
  });
});

// ============================================================
// AUTH
// ============================================================
const AUTH_KEY = 'qrt_auth';
function initAuth() {
  // Draw auth kirby
  document.getElementById('auth-kirby').innerHTML = kirbyHTML(90, true);

  // Check stored auth
  if (sessionStorage.getItem(AUTH_KEY) === '1') {
    showApp();
    return;
  }

  document.getElementById('pw').addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const val = e.target.value;
      // Default password: "orfe28" â€” change the hash below to use a different one
      if (simpleHash(val) === '43a8') {
        sessionStorage.setItem(AUTH_KEY, '1');
        showApp();
      } else {
        document.getElementById('pw-err').textContent = 'ACCESS DENIED';
        e.target.value = '';
      }
    }
  });
}

function showApp() {
  document.getElementById('auth').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  load();
  renderOverview();
}

// Boot
initAuth();
</script>
</body>
</html>
